tosca_definitions_version: ${alien4cloud.dsl.version}

template_name: yorc-slurm-types
template_author: Yorc
template_version: ${yorc.types.version}

description: "Defines resources for the Yorc plugin, slurm configuration."

imports:
  - tosca-normative-types:${tosca.normative.types.version}
  - yorc-types:${yorc.types.version}


artifact_types:
  yorc.artifacts.Deployment.SlurmJob:
    description: Slurm Job deployment descriptor
    derived_from: tosca.artifacts.Deployment
  yorc.artifacts.Deployment.SlurmJobScript:
    description: Slurm Job Script deployment descriptor
    derived_from: yorc.artifacts.Deployment.SlurmJob

node_types:
  yorc.nodes.slurm.Compute:
    derived_from: yorc.nodes.Compute
    properties:
      gres:
        type: string
        required: false
      partition:
        type: string
        required: false
        description: Slurm partition where the nodes will be deployed
      job_name:
        type: string
        required: false
        description: Specify a name for the job allocation. The specified name will appear along with the job id.
    attributes:
      cuda_visible_devices:
        type: string
        description: Coma separated list of visibles GPU devices for the compute.
      job_id:
        type: string
        description: The ID of the job allocation.
      partition:
        type: string
        description: Slurm partition where the nodes are deployed.

  yorc.nodes.slurm.Job:
    derived_from: org.alien4cloud.nodes.Job
    properties:
      name:
        type: string
        description: The job name.
        required: false
      tasks:
        description: Number of tasks to run in parallel.
        type: integer
        required: false
        default: 1
      nodes:
        description: Minimum number of nodes allocated to the job
        type: integer
        required: false
        default: 1
      cpus:
        description: >
          Number of cpus allocated per task. Depending upon system configuration, cpu can be either a core or a thread.
        type: integer
        required: false
      mem:
        type: integer
        description: The memory per node in GB required to the job.
        required: false
      extra_job_options:
        type: list
        description: Extra job options.
        required: false
        entry_schema:
          type: string
    attributes:
      job_id:
        type: string
        description: The ID of the job allocation.
    interfaces:
      tosca.interfaces.node.lifecycle.Runnable:
        run:
          implementation:
            file:
            type: yorc.artifacts.Deployment.SlurmJob